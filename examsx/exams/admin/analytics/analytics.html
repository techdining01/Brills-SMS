{% extends "base.html" %}
{% block title %}Admin Analytics{% endblock %}

{% block content %}
<div class="container py-4">
    <h4 class="fw-bold mb-4">ðŸ“Š Admin Analytics</h4>

    <div class="row g-4">
        <div class="col-md-6">
            <canvas id="revenueChart"></canvas>
        </div>
        <div class="col-md-6">
            <canvas id="ordersChart"></canvas>
        </div>
        <div class="col-md-6">
            <canvas id="examChart"></canvas>
        </div>
        <div class="col-md-6">
            <canvas id="userChart"></canvas>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
fetch("{% url 'accounts:admin_analytics' %}")
.then(r => r.json())
.then(data => {

    new Chart(document.getElementById("revenueChart"), {
        type: "line",
        data: {
            labels: data.revenue.map(r => r.day),
            datasets: [{ label: "Revenue", data: data.revenue.map(r => r.total) }]
        }
    });

    new Chart(document.getElementById("ordersChart"), {
        type: "doughnut",
        data: {
            labels: data.orders.map(o => o.status),
            datasets: [{ data: data.orders.map(o => o.count) }]
        }
    });

    new Chart(document.getElementById("examChart"), {
        type: "bar",
        data: {
            labels: data.exams.map(e => e.title),
            datasets: [{ label: "Attempts", data: data.exams.map(e => e.attempts) }]
        }
    });

    new Chart(document.getElementById("userChart"), {
        type: "pie",
        data: {
            labels: data.users.map(u => u.role),
            datasets: [{ data: data.users.map(u => u.count) }]
        }
    });

});
</script>
{% endblock %}
