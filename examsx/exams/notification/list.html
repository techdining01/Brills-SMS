{% extends "base.html" %}
{% block content %}
<div class="container mt-4">
  <h5>Notifications</h5>

  <ul class="list-group">
    {% for n in notifications %}
      <li class="list-group-item {% if not n.is_read %}list-group-item-warning{% endif %}">
        <strong>{{ n.title }}</strong> - {{ n.message }} 
        <small class="text-muted">{{ n.created_at }}</small>
        {% if not n.is_read %}
          <button class="btn btn-sm btn-outline-primary float-end mark-read" data-id="{{ n.id }}">Mark as read</button>
        {% endif %}
      </li>
    {% endfor %}
  </ul>
</div>

<script>
document.querySelectorAll('.mark-read').forEach(btn=>{
    btn.addEventListener('click', e=>{
        const id = btn.dataset.id;
        fetch(`/notifications/mark-read/${id}/`, {method: 'POST', headers:{'X-CSRFToken':'{{ csrf_token }}'}})
            .then(res=>res.json())
            .then(data=>{
                if(data.status==='ok') btn.parentElement.classList.remove('list-group-item-warning');
                btn.remove();
            })
    })
});
</script>
{% endblock %}
