{% extends "base.html" %}
{% block title %}Staff Dashboard{% endblock %}

{% block content %}
<div class="row g-3">

  <div class="col-md-4">
    <div class="card stat-card p-3">
      <h6>Total Payslips</h6>
      <h3>{{ payslips.count }}</h3>
    </div>
  </div>

  <div class="col-md-4">
    <div class="card stat-card p-3">
      <h6>Active Loans</h6>
      <h3>{{ loans|length }}</h3>
    </div>
  </div>

  <div class="col-md-4">
    <div class="card stat-card p-3">
      <h6>Leave Requests</h6>
      <h3>{{ leaves|length }}</h3>
    </div>
  </div>

</div>

<hr>

<h5>Payslips</h5>
<table class="table table-striped">
  <tr>
    <th>Period</th>
    <th>Net Pay</th>
    <th></th>
  </tr>
  {% for p in payslips %}
  <tr>
    <td>{{ p.payroll_period }}</td>
    <td>â‚¦{{ p.net_pay }}</td>
    <td>
      <a href="{% url 'payslip_pdf' p.id %}" class="btn btn-sm btn-primary">
        Download
      </a>
    </td>
  </tr>
  {% endfor %}
</table>
<canvas id="payrollChart"></canvas>

<script>
fetch("{% url 'payroll_chart_data' %}")
.then(res => res.json())
.then(data => {
  new Chart(document.getElementById("payrollChart"), {
    type: "bar",
    data: {
      labels: data.labels,
      datasets: [
        { label: "Net Pay", data: data.net_pay },
        { label: "Deductions", data: data.deductions }
      ]
    }
  });
});
</script>

{% endblock %}
