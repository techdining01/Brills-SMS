
{% extends "base.html" %}
{% block content %}

<div class="container">
  <h4 class="mb-4">My Loans</h4>

  {% for loan in loans %}
  <div class="card mb-4 shadow-sm">
    <div class="card-body">

      <h6 class="fw-bold">{{ loan.purpose }}</h6>

      <p class="mb-1">
        Amount: ₦{{ loan.amount }} <br>
        Outstanding: ₦{{ loan.outstanding_balance }} <br>
        Status:
        <span class="badge bg-{% if loan.status == 'completed' %}success{% else %}warning{% endif %}">
          {{ loan.status|title }}
        </span>
      </p>

      {% with paid=loan.amount|floatformat:2|add:"-"|add:loan.outstanding_balance %}
      {% widthratio paid loan.amount 100 as percent %}
      <div class="progress mb-3" style="height: 8px;">
        <div
          class="progress-bar bg-success"
          style="width: {{ percent }}%">
        </div>
      </div>
      {% endwith %}

      <small class="text-muted">Repayment History</small>

      <table class="table table-sm mt-2">
        <thead>
          <tr>
            <th>Date</th>
            <th>Amount</th>
            <th>Balance After</th>
          </tr>
        </thead>
        <tbody>
          {% for r in loan.repayments.all %}
          <tr>
            <td>{{ r.created_at|date:"M Y" }}</td>
            <td>₦{{ r.amount }}</td>
            <td>₦{{ r.balance_after }}</td>
          </tr>
          {% empty %}
          <tr><td colspan="3" class="text-muted">No repayments yet</td></tr>
          {% endfor %}
        </tbody>
      </table>

    </div>
  </div>
  {% empty %}
  <p class="text-muted">You have no loans.</p>
  {% endfor %}
</div>

{% endblock %}
