{% extends "base.html" %}
{% block title %}Exam Access Control{% endblock %}

{% block content %}
<div class="container py-4">

  <h4 class="fw-bold mb-3">Exam / Service Access</h4>

  <div class="card shadow-sm">
    <div class="card-body p-0">
      <div class="table-responsive">
        <table class="table table-striped table-responsive-stack align-middle mb-0">
          <thead>
            <tr>
              <th class="ps-4">Student</th>
              <th>Exam</th>
              <th>Granted Via</th>
              <th>Granted By</th>
              <th>Date</th>
              <th class="text-end pe-4">Action</th>
            </tr>
          </thead>
          <tbody>
            {% for a in accesses %}
            <tr>
              <td data-label="Student" class="ps-4">{{ a.student.get_full_name }}</td>
              <td data-label="Exam">{{ a.exam.title }}</td>
              <td data-label="Granted Via">
                {% if a.via_payment %}
                  <span class="badge bg-success">Payment</span>
                {% elif a.granted_by %}
                  <span class="badge bg-secondary">Manual</span>
                {% else %}
                  <span class="badge bg-info">System</span>
                {% endif %}
              </td>
              <td data-label="Granted By">
                {% if a.via_payment and not a.granted_by %}
                  System
                {% elif a.granted_by %}
                  {{ a.granted_by }}
                {% else %}
                  System
                {% endif %}
              </td>
              <td data-label="Date">{{ a.granted_at|date:"d-m-Y H:i" }}</td>
              <td data-label="Action" class="text-end pe-4">
                <a
                  href="{% url 'brillspay:admin_revoke_access' a.id %}"
                  class="btn btn-sm btn-danger rounded-pill"
                  onclick="return confirm('Revoke this access?')"
                >
                  Revoke
                </a>
              </td>
            </tr>
            {% empty %}
            <tr>
              <td colspan="6" class="text-center py-5 text-muted">
                No access records found
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
      {% if accesses.has_other_pages %}
      <div class="border-top px-3 py-2">
        <nav aria-label="Access pagination">
          <ul class="pagination justify-content-center mb-0">
            {% if accesses.has_previous %}
            <li class="page-item">
              <a class="page-link" href="?page={{ accesses.previous_page_number }}" aria-label="Previous">
                <span aria-hidden="true">&laquo;</span>
              </a>
            </li>
            {% else %}
            <li class="page-item disabled">
              <span class="page-link">&laquo;</span>
            </li>
            {% endif %}

            {% for i in accesses.paginator.page_range %}
              {% if accesses.number == i %}
              <li class="page-item active"><span class="page-link">{{ i }}</span></li>
              {% else %}
              <li class="page-item"><a class="page-link" href="?page={{ i }}">{{ i }}</a></li>
              {% endif %}
            {% endfor %}

            {% if accesses.has_next %}
            <li class="page-item">
              <a class="page-link" href="?page={{ accesses.next_page_number }}" aria-label="Next">
                <span aria-hidden="true">&raquo;</span>
              </a>
            </li>
            {% else %}
            <li class="page-item disabled">
              <span class="page-link">&raquo;</span>
            </li>
            {% endif %}
          </ul>
        </nav>
      </div>
      {% endif %}
    </div>
  </div>

</div>
{% endblock %}
