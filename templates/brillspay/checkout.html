{% extends "base.html" %}
{% load static %}

{% block title %}Checkout | BrillsPay{% endblock %}

{% block content %}
<div class="container">

  <div class="row mb-4">
    <div class="col-md-8">
      <h4 class="fw-bold">Checkout</h4>
      <p class="text-muted">
        Review items for <strong>{{ order.ward.get_full_name }} ({{order.ward.student_class}})</strong>
      </p>
    </div>

    <div class="col-md-4 text-md-end">
      <a href="javascript:void(0)" onclick="history.back()" class="btn btn-outline-secondary">
        ← Continue Shopping
      </a>
    </div>

  <div class="card shadow-sm mb-4">
    <div class="card-body">

      <div class="table-responsive">
        <table class="table align-middle table-responsive-stack">
          <thead>
            <tr>
              <th>Product</th>
              <th>Qty</th>
              <th class="text-end">Subtotal</th>
            </tr>
          </thead>

          <tbody>
            {% for item in order.items.all %}
            <tr>
              <td data-label="Product" class="d-flex align-items-center gap-3">
                {% if item.product and item.product.image %}
                  <img src="{{ item.product.image.url }}"
                       class="rounded"
                       width="50"
                       height="50"
                       style="object-fit:cover">
                {% else %}
                  <img src="{% static 'images/default_product.png' %}"
                       width="50"
                       height="50">
                {% endif %}
                <div>
                  <div class="fw-semibold">{{ item.product_name }}</div>
                  <small class="text-muted">₦{{ item.price }}</small>
                </div>
              </td>

              <td data-label="Qty">{{ item.quantity }}</td>
              <td data-label="Subtotal" class="text-end">₦{{ item.subtotal|floatformat:2 }}</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

      <hr>

      <div class="d-flex justify-content-between fw-bold fs-5">
        <span>Total</span>
        <span>₦{{ order.total_amount|floatformat:2 }}</span>
      </div>
    </div>
  </div>

  {% if order.status == "PENDING" %}
    <a href="{% url 'brillspay:paystack_init' order.id %}"
       class="btn btn-primary btn-lg w-100">
      Pay with Paystack
    </a>
  {% else %}
    <button class="btn btn-secondary w-100" disabled>
      Payment Not Available
    </button>
  {% endif %}

</div>
{% endblock %}
