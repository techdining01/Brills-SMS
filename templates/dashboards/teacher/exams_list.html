{% extends 'base.html' %}
{% load static %}

{% block title %}My Exams - Teacher Dashboard{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <div class="row mb-4 align-items-center">
        <div class="col-md-6">
            <h2 class="mb-0"><i class="bi bi-file-earmark-text"></i> My Exams</h2>
        </div>
        <div class="col-md-6 text-end">
            <div class="d-flex justify-content-md-end gap-2">
                <a href="{% url 'dashboards:create_exam' %}" class="btn btn-primary">
                    <i class="bi bi-plus-circle"></i> Create New Exam
                </a>
                <a href="{% url 'dashboards:teacher_dashboard' %}" class="btn btn-outline-secondary">
                    <i class="bi bi-arrow-left"></i> Back to Dashboard
                </a>
            </div>
        </div>
    </div>

    <div class="card">
        <div class="card-header">
            <div class="row">
                <div class="col-md-6">
                    <input type="text" id="exam-search" name="search" class="form-control form-control-sm" placeholder="Search exams...">
                </div>
                <div class="col-md-3">
                    <select id="status-filter" name="status" class="form-select form-select-sm">
                        <option value="">All Status</option>
                        <option value="Published">Published</option>
                        <option value="Draft">Draft</option>
                    </select>
                </div>
            </div>
        </div>
        <div class="table-responsive">
            <table class="table table-hover mb-0">
                <thead class="table-light">
                    <tr>
                        <th>Exam Title</th>
                        <th>Class</th>
                        <th>Questions</th>
                        <th>Duration</th>
                        <th>Attempts</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="exams-table-body">
                    {% include 'dashboards/teacher/partials/exams_table_rows.html' %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const searchInput = document.getElementById('exam-search');
    const statusFilter = document.getElementById('status-filter');
    const tableBody = document.getElementById('exams-table-body');
    
    function filterExams() {
        const searchQuery = searchInput.value;
        const statusValue = statusFilter.value;
        
        const url = new URL(window.location.href);
        if (searchQuery) {
            url.searchParams.set('search', searchQuery);
        } else {
            url.searchParams.delete('search');
        }
        
        if (statusValue) {
            url.searchParams.set('status', statusValue);
        } else {
            url.searchParams.delete('status');
        }
        
        // Update URL without reloading (optional, good for bookmarking)
        window.history.pushState({}, '', url);

        fetch(url.toString(), {
            headers: {
                'X-Requested-With': 'XMLHttpRequest'
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.html) {
                tableBody.innerHTML = data.html;
            }
        })
        .catch(error => console.error('Error:', error));
    }
    
    let timeoutId;
    searchInput.addEventListener('input', function() {
        clearTimeout(timeoutId);
        timeoutId = setTimeout(filterExams, 300);
    });
    
    statusFilter.addEventListener('change', filterExams);
});
</script>
{% endblock %}
