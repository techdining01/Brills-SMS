{% extends "base.html" %}
{% load static %}
{% block title %}Teacher Exam Analytics{% endblock %}

{% block content %}
<div class="container-fluid mt-4">

  <h3 class="mb-4">ðŸ“Š Exam Analytics Dashboard</h3>

  <div class="row g-4">
    {% for exam_data in analytics %}
    <div class="col-md-6 col-lg-4">
      <div class="card shadow-sm border-0 h-100">
        <div class="card-body">
          <h5 class="card-title">{{ exam_data.exam.title }}</h5>
          <p class="text-muted mb-2">Class: {{ exam_data.exam.school_class }}</p>

          <ul class="list-group list-group-flush mb-3">
            <li class="list-group-item d-flex justify-content-between align-items-center">
              Total Attempts
              <span class="badge bg-primary rounded-pill">{{ exam_data.total_attempts }}</span>
            </li>
            <li class="list-group-item d-flex justify-content-between align-items-center">
              Completed
              <span class="badge bg-success rounded-pill">{{ exam_data.completed }}</span>
            </li>
            <li class="list-group-item d-flex justify-content-between align-items-center">
              Avg Score
              <span class="badge bg-info rounded-pill">{{ exam_data.avg_score|floatformat:1 }}</span>
            </li>
            <li class="list-group-item d-flex justify-content-between align-items-center">
              Pending Marking
              <span class="badge bg-danger rounded-pill">{{ exam_data.pending_marking }}</span>
            </li>
          </ul>

          <a href="{% url 'teachers:exam_marking' exam_data.exam.id %}" class="btn btn-sm btn-primary w-100">
            Go to Marking Dashboard
          </a>
        </div>
      </div>
    </div>
    {% empty %}
    <div class="col-12">
      <div class="alert alert-warning text-center">
        No exams created yet.
      </div>
    </div>
    {% endfor %}
  </div>

  <!-- Optional: Chart per exam -->
  <div class="row mt-5">
    <div class="col-12">
      <div class="card shadow-sm border-0">
        <div class="card-body">
          <h5 class="card-title">Exam Completion Overview</h5>
          <canvas id="examChart" height="100"></canvas>
        </div>
      </div>
    </div>
  </div>

</div>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
const ctx = document.getElementById('examChart').getContext('2d');
const labels = [
    {% for exam_data in analytics %}
      "{{ exam_data.exam.title }}",
    {% endfor %}
];
const data = {
    labels: labels,
    datasets: [{
        label: 'Completed vs Pending',
        data: [
          {% for exam_data in analytics %}
            {{ exam_data.completed }},
          {% endfor %}
        ],
        backgroundColor: 'rgba(40, 167, 69, 0.6)'
    },{
        label: 'Pending Marking',
        data: [
          {% for exam_data in analytics %}
            {{ exam_data.pending_marking }},
          {% endfor %}
        ],
        backgroundColor: 'rgba(220, 53, 69, 0.6)'
    }]
};
const config = {
    type: 'bar',
    data: data,
    options: {
        responsive: true,
        plugins: {
          legend: { position: 'top' },
          title: { display: true, text: 'Exam Analytics Overview' }
        }
    }
};
new Chart(ctx, config);
</script>
{% endblock %}
